<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‚¬ì›ë³„ ë¦¬í¬íŠ¸ ë°°í¬ ë„êµ¬</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #F8F7F4;
            color: #333;
        }
        .chart-container {
            position: relative;
            width: 100%;
            height: 400px;
        }
        /* Custom modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }
        .modal-content {
            background-color: #fff;
            margin: 15% auto;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            text-align: center;
        }
        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .mobile-preview-container {
            max-width: 375px; /* Typical mobile width */
            margin: 0 auto;
            border: 2px solid #ddd;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            overflow-x: auto; /* Allow horizontal scrolling for wide images */
        }
    </style>
</head>
<body class="antialiased p-6">
    <div class="container mx-auto max-w-4xl bg-white p-8 rounded-xl shadow-lg my-12">
        <header class="text-center mb-10">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-2">ì‚¬ì› ë¦¬í¬íŠ¸ ë°°í¬ ë„êµ¬</h1>
            <p class="text-lg text-gray-600">ì‚¬ì›ë³„ ë§ì¶¤í˜• ë¦¬í¬íŠ¸ë¥¼ ì´ë¯¸ì§€ë¡œ ìº¡ì²˜í•˜ê³  ë³µì‚¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        </header>

        <section class="mb-8">
            <div class="flex flex-col md:flex-row items-center justify-center space-y-4 md:space-y-0 md:space-x-4">
                <input type="text" id="employeeNameInput" placeholder="ì‚¬ì›ëª… (ì˜ˆ: ë°•ì—°ì‹¤)" class="w-full md:w-1/2 p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <button id="previewButton" class="w-full md:w-auto px-6 py-3 bg-blue-600 text-white font-bold rounded-lg shadow-md hover:bg-blue-700 transition duration-300">í™”ë©´ ë¯¸ë¦¬ë³´ê¸°</button>
                <button id="captureAndCopyButton" class="w-full md:w-auto px-6 py-3 bg-green-600 text-white font-bold rounded-lg shadow-md hover:bg-green-700 transition duration-300">ì´ë¯¸ì§€ ë³µì‚¬</button>
            </div>
        </section>

        <section id="preview-section" class="p-6 border border-dashed border-gray-300 rounded-xl hidden">
            <div id="preview-content" class="bg-white p-4 rounded-lg shadow-inner">
                <div class="text-center text-gray-500">
                    <p>ë¯¸ë¦¬ë³´ê¸°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
                </div>
            </div>
        </section>
    </div>

    <!-- The Modal -->
    <div id="copyModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <div id="modalContent">
                <!-- Content will be inserted here -->
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Employee data and feedback. This data is kept here for demonstration purposes.
            // In a real-world scenario, this would be fetched from a database.
            const employeeData = [
                {
                    name: 'ë°•ì—°ì‹¤', total: 96, scores: [8, 9, 10, 10, 9, 10, 10, 10, 10, 10],
                    feedback: [
                        { rationale: 'ì œí’ˆ íŠ¹ì§•ì„ ëª…í™•í•˜ê³  ìì‹ ê° ìˆê²Œ ì „ë‹¬í•˜ì—¬ ê³ ê°ì˜ ì´í•´ë¥¼ ë„ì™”ìŠµë‹ˆë‹¤.', improvement: 'í˜„ì¬ë„ í›Œë¥­í•©ë‹ˆë‹¤. ì™„ë²½í•œ ì„¤ëª…ì„ í†µí•´ ë”ìš± ì‹ ë¢°ë¥¼ ë†’ì—¬ì£¼ì„¸ìš”.' },
                        { rationale: 'ê³ ê°ì´ ì‰½ê²Œ ë”°ë¼ í•  ìˆ˜ ìˆë„ë¡ ë‹¨ê³„ë³„ë¡œ ì¹œì ˆí•˜ê²Œ ì„¤ëª…í–ˆìŠµë‹ˆë‹¤.', improvement: 'í˜„ì¬ë„ í›Œë¥­í•©ë‹ˆë‹¤. ì‚¬ìš© íŒì„ ì¶”ê°€í•˜ì—¬ ì „ë¬¸ì„±ì„ ê°•ì¡°í•˜ë©´ ì¢‹ìŠµë‹ˆë‹¤.' },
                        { rationale: 'ê³ ê°ì˜ êµ¬ë§¤ ì‹¬ë¦¬ë¥¼ íŒŒì•…í•˜ì—¬ ìì—°ìŠ¤ëŸ½ê²Œ ë¬¶ìŒ íŒë§¤ë¥¼ ìœ ë„í–ˆìŠµë‹ˆë‹¤.', improvement: 'ì¶”ê°€ì ì¸ ë¬¶ìŒ ìƒí’ˆ ì¡°í•©ì„ ì œì•ˆí•˜ì—¬ ê°ë‹¨ê°€ë¥¼ ë†’ì—¬ì£¼ì„¸ìš”.' },
                        { rationale: 'ë§¤ìš° ì¹œì ˆí•œ ëª©ì†Œë¦¬ í†¤ê³¼ ë”°ëœ»í•œ ì‘ëŒ€ë¡œ ê³ ê° ë§Œì¡±ë„ë¥¼ ê·¹ëŒ€í™”í–ˆìŠµë‹ˆë‹¤.', improvement: 'í˜„ì¬ë„ ì™„ë²½í•©ë‹ˆë‹¤. ì§€ê¸ˆì²˜ëŸ¼ ê¾¸ì¤€íˆ ì¹œì ˆí•¨ì„ ìœ ì§€í•´ ì£¼ì„¸ìš”.' },
                        { rationale: 'ì‹œì¢…ì¼ê´€ í”ë“¤ë¦¼ ì—†ëŠ” ëª©ì†Œë¦¬ì™€ í™•ì‹  ìˆëŠ” íƒœë„ë¡œ ê³ ê°ì—ê²Œ ì‹ ë¢°ë¥¼ ì£¼ì—ˆìŠµë‹ˆë‹¤.', improvement: 'í˜„ì¬ë„ í›Œë¥­í•©ë‹ˆë‹¤. ìì‹ ê° ìˆëŠ” ëª¨ìŠµì€ íŒë§¤ì— í° ë„ì›€ì´ ë©ë‹ˆë‹¤.' },
                        { rationale: 'ê³ ê°ê³¼ì˜ ëŒ€í™”ë¥¼ ìì—°ìŠ¤ëŸ½ê²Œ ì´ëŒë©° ê¸ì •ì ì¸ ë¶„ìœ„ê¸°ë¥¼ ì¡°ì„±í–ˆìŠµë‹ˆë‹¤.', improvement: 'ê³ ê°ì˜ ì´ì•¼ê¸°ì— ë”ìš± ì ê·¹ì ìœ¼ë¡œ ê³µê°í•˜ëŠ” í‘œí˜„ì„ ì‚¬ìš©í•˜ë©´ ë”ìš± ì¢‹ìŠµë‹ˆë‹¤.' },
                        { rationale: 'ê³ ê°ì˜ í•œë‘ ë§ˆë””ì—ì„œ ìˆ¨ê²¨ì§„ ë‹ˆì¦ˆë¥¼ ì •í™•íˆ íŒŒì•…í–ˆìŠµë‹ˆë‹¤.', improvement: 'í˜„ì¬ë„ íƒì›”í•©ë‹ˆë‹¤. íŒŒì•…ëœ ë‹ˆì¦ˆë¥¼ ë°”íƒ•ìœ¼ë¡œ ìƒˆë¡œìš´ ì œí’ˆì„ ì œì•ˆí•˜ëŠ” í›ˆë ¨ì„ í•´ë³´ì„¸ìš”.' },
                        { rationale: 'ê³ ê°ì˜ ìƒí™©ê³¼ ì·¨í–¥ì— ë§ëŠ” ì œí’ˆì„ ì •í™•íˆ ì¶”ì²œí–ˆìŠµë‹ˆë‹¤.', improvement: 'ê³ ê°ì˜ ê°€ì¡± êµ¬ì„±ì›ê¹Œì§€ ê³ ë ¤í•œ ë§ì¶¤í˜• ì¶”ì²œì€ ë”ìš± ê°ë™ì„ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.' },
                        { rationale: 'ìœ ë¨¸ëŸ¬ìŠ¤í•˜ê³  ì¬ì¹˜ ìˆëŠ” ë©˜íŠ¸ë¡œ ê³ ê°ì—ê²Œ ì¦ê±°ìš´ ê²½í—˜ì„ ì„ ì‚¬í–ˆìŠµë‹ˆë‹¤.', improvement: 'í˜„ì¬ë„ í›Œë¥­í•©ë‹ˆë‹¤. íŠ¹ì • ìƒí™©ì— ë§ëŠ” ë§ì¶¤í˜• ìœ ë¨¸ë¥¼ ê°œë°œí•˜ë©´ ì¢‹ìŠµë‹ˆë‹¤.' },
                        { rationale: 'êµ¬ë§¤ë¥¼ ë§ì„¤ì´ëŠ” ê³ ê°ì—ê²Œ í™•ì‹¤í•œ í™•ì‹ ì„ ì£¼ì–´ íŒë§¤ë¥¼ ì„±ê³µì ìœ¼ë¡œ ë§ˆë¬´ë¦¬í–ˆìŠµë‹ˆë‹¤.', improvement: 'í˜„ì¬ë„ ì™„ë²½í•©ë‹ˆë‹¤. í´ë¡œì§• ë©˜íŠ¸ë¥¼ ë‹¤ì–‘í™”í•˜ì—¬ ë”ìš± ë…¸ë ¨í•´ì§€ë©´ ì¢‹ìŠµë‹ˆë‹¤.' }
                    ]
                },
                {
                    name: 'ê¹€ìˆ™ì', total: 70, scores: [8, 5, 6, 9, 7, 9, 7, 5, 6, 8],
                    feedback: [
                        { rationale: 'ì œí’ˆ íŠ¹ì§•ì„ ì°¨ë¶„í•˜ê²Œ ì„¤ëª…í•˜ì—¬ ê³ ê°ì´ í¸ì•ˆí•˜ê²Œ ë“¤ì„ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.', improvement: 'ì„¤ëª… ì‹œì— í•µì‹¬ì ì¸ ê°•ì ì„ ê°•ì¡°í•˜ëŠ” ì—°ìŠµì´ í•„ìš”í•©ë‹ˆë‹¤.' },
                        { rationale: 'ì œí’ˆ ì‚¬ìš© ì„¤ëª…ì´ ë‹¤ì†Œ ë¶€ì¡±í•˜ê³  ì¶”ìƒì ìœ¼ë¡œ ë“¤ë ¸ìŠµë‹ˆë‹¤.', improvement: 'ê³ ê°ì´ ì‹¤ì œë¡œ ì‚¬ìš©í•˜ëŠ” ëª¨ìŠµì„ ìƒìƒí•  ìˆ˜ ìˆë„ë¡ êµ¬ì²´ì ì¸ ì˜ˆë¥¼ ë“¤ì–´ ì„¤ëª…í•´ ì£¼ì„¸ìš”.' },
                        { rationale: 'ë¬¶ìŒ íŒë§¤ ì œì•ˆì´ ê±°ì˜ ì—†ê±°ë‚˜ ê³ ê° ë°˜ì‘ì„ ì‚´í”¼ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.', improvement: 'ê³ ê°ì´ ê´€ì‹¬ì„ ë³´ì¼ ë•Œ 2ê°œ ì´ìƒ êµ¬ë§¤ ì‹œ í˜œíƒì„ ìì—°ìŠ¤ëŸ½ê²Œ ì–¸ê¸‰í•˜ëŠ” ì—°ìŠµì´ í•„ìš”í•©ë‹ˆë‹¤.' },
                        { rationale: 'ë§¤ìš° ì¹œì ˆí•˜ê³  ìƒëƒ¥í•œ íƒœë„ë¡œ ê³ ê°ì„ ì‘ëŒ€í–ˆìŠµë‹ˆë‹¤.', improvement: 'ì¹œì ˆí•œ íƒœë„ëŠ” í° ì¥ì ì…ë‹ˆë‹¤. ì´ë¥¼ ê³„ì† ìœ ì§€í•´ì£¼ì„¸ìš”.' },
                        { rationale: 'ìì‹ ê°ì´ ë‹¤ì†Œ ë¶€ì¡±í•˜ì—¬ ëª©ì†Œë¦¬ê°€ ì‘ì•„ì§€ëŠ” ê²½í–¥ì´ ë³´ì˜€ìŠµë‹ˆë‹¤.', improvement: 'í™•ì‹ ì— ì°¬ ëª©ì†Œë¦¬ë¡œ ë˜ë°•ë˜ë°• ë§í•˜ëŠ” ì—°ìŠµì„ í•˜ë©´ ì¢‹ìŠµë‹ˆë‹¤.' },
                        { rationale: 'ê³ ê°ì˜ ì§ˆë¬¸ì— ëŒ€í•œ ë‹µë³€ì€ ì¢‹ì•˜ìœ¼ë‚˜, ë¨¼ì € ëŒ€í™”ë¥¼ ì´ëŒì–´ê°€ëŠ” ëŠ¥ë ¥ì´ ì•„ì‰½ìŠµë‹ˆë‹¤.', improvement: 'ê³ ê°ì—ê²Œ ë¨¼ì € ë§ì„ ê±¸ê³  í¥ë¯¸ë¥¼ ìœ ë°œí•  ìˆ˜ ìˆëŠ” ì§ˆë¬¸ì„ ì¤€ë¹„í•´ ë³´ì„¸ìš”.' },
                        { rationale: 'ê³ ê°ì˜ ë°˜ì‘ì—ë§Œ ì˜ì¡´í•˜ì—¬ ìˆ¨ê²¨ì§„ ë‹ˆì¦ˆë¥¼ íŒŒì•…í•˜ëŠ” ë…¸ë ¥ì´ ë¶€ì¡±í–ˆìŠµë‹ˆë‹¤.', improvement: 'ì œí’ˆì— ëŒ€í•œ ê³ ê°ì˜ ê¸°ëŒ€ë‚˜ í•„ìš”ë¥¼ ì•Œì•„ë‚´ê¸° ìœ„í•œ ì§ˆë¬¸ì„ ë˜ì ¸ë³´ì„¸ìš”.' },
                        { rationale: 'ê³ ê°ì˜ ìƒí™©ê³¼ ì—°ê²°ëœ ì œí’ˆ ì¶”ì²œì´ ì•½í–ˆìŠµë‹ˆë‹¤.', improvement: "ê³ ê°ì´ 'ë‚˜ì—ê²Œ ê¼­ ë§ëŠ” ì œí’ˆì´êµ¬ë‚˜'ë¼ê³  ëŠë‚„ ìˆ˜ ìˆë„ë¡ ë§ì¶¤í˜• ì¶”ì²œ ë©˜íŠ¸ë¥¼ ì—°ìŠµí•´ì£¼ì„¸ìš”." },
                        { rationale: 'ì¬ì¹˜ ìˆëŠ” ë©˜íŠ¸ê°€ ê±°ì˜ ì—†ì–´ì„œ ëŒ€í™”ê°€ ë‹¨ì¡°ë¡œì›Œì¡ŒìŠµë‹ˆë‹¤.', improvement: 'ê°„ë‹¨í•œ ìœ ë¨¸ë‚˜ ê³µê° ë©˜íŠ¸ë¥¼ ì‚¬ìš©í•´ì„œ ë¶„ìœ„ê¸°ë¥¼ ë°ê²Œ ë§Œë“¤ë©´ ì¢‹ìŠµë‹ˆë‹¤.' },
                        { rationale: 'êµ¬ë§¤ ìœ ë„ë¥¼ ì‹œë„í–ˆì§€ë§Œ, ê³ ê°ì—ê²Œ í™•ì‹ ì„ ì£¼ëŠ” ë©˜íŠ¸ê°€ ì•½í–ˆìŠµë‹ˆë‹¤.', improvement: 'êµ¬ë§¤ ê²°ì • í›„ "ì •ë§ ì¢‹ì€ ì„ íƒì…ë‹ˆë‹¤"ì™€ ê°™ì€ ê¸ì •ì ì¸ í´ë¡œì§• ë©˜íŠ¸ë¥¼ ì‚¬ìš©í•´ ì£¼ì„¸ìš”.' }
                    ]
                },
                {
                    name: 'ì„í˜„ìˆ™', total: 70, scores: [9, 8, 6, 7, 9, 6, 6, 6, 7, 6],
                    feedback: [
                        { rationale: 'ì œí’ˆì˜ í•µì‹¬ íŠ¹ì§•ì„ ì˜ ì„¤ëª…í–ˆìŠµë‹ˆë‹¤.', improvement: 'ê³ ê°ì˜ ì´í•´ë„ë¥¼ ë†’ì¼ ìˆ˜ ìˆë„ë¡ ì¶”ê°€ì ì¸ ë¹„ìœ ë‚˜ ì„¤ëª…ì„ ë§ë¶™ì—¬ ë³´ì„¸ìš”.' },
                        { rationale: 'ì œí’ˆ ì‚¬ìš©ë²•ì„ ëª…í™•í•˜ê²Œ ì „ë‹¬í–ˆìŠµë‹ˆë‹¤.', improvement: 'ê³ ê°ì˜ ì´í•´ë„ë¥¼ í™•ì¸í•˜ê³ , ì¶”ê°€ ì§ˆë¬¸ì´ ì—†ëŠ”ì§€ ë¬¼ì–´ë³´ëŠ” ìŠµê´€ì„ ë“¤ì´ë©´ ì¢‹ìŠµë‹ˆë‹¤.' },
                        { rationale: 'ë¬¶ìŒ íŒë§¤ ì œì•ˆì´ ë¶€ì¡±í–ˆìŠµë‹ˆë‹¤.', improvement: '2ê°œ ì´ìƒ êµ¬ë§¤ ì‹œì˜ ê°€ê²© í˜œíƒì„ ì ê·¹ì ìœ¼ë¡œ ì–´í•„í•´ ë³´ì„¸ìš”.' },
                        { rationale: 'ì¹œì ˆí–ˆì§€ë§Œ, ê³ ê°ì˜ ê°ì •ì„ ì½ëŠ” ê³µê° ëŠ¥ë ¥ì´ ì•„ì‰¬ì› ìŠµë‹ˆë‹¤.', improvement: 'ê³ ê°ì˜ ë°˜ì‘ì— ë§ì¶° ëª©ì†Œë¦¬ í†¤ì´ë‚˜ ì†ë„ë¥¼ ì¡°ì ˆí•´ ë³´ì„¸ìš”.' },
                        { rationale: 'ìì‹ ê° ìˆëŠ” ëª©ì†Œë¦¬ë¡œ ì‘ëŒ€í•˜ì—¬ ì‹ ë¢°ë¥¼ ì£¼ì—ˆìŠµë‹ˆë‹¤.', improvement: 'ê³„ì†í•´ì„œ í™•ì‹  ìˆëŠ” ëª¨ìŠµì„ ìœ ì§€í•´ ì£¼ì„¸ìš”.' },
                        { rationale: 'ë‹¨ë‹µí˜•ìœ¼ë¡œ ì‘ëŒ€í•˜ëŠ” ê²½í–¥ì´ ìˆì—ˆìŠµë‹ˆë‹¤.', improvement: 'ê³ ê°ì˜ ì§ˆë¬¸ì— ë‹µí•œ í›„ ì¶”ê°€ì ì¸ ì •ë³´ë¥¼ ì œê³µí•˜ì—¬ ëŒ€í™”ë¥¼ ì´ì–´ê°€ ë³´ì„¸ìš”.' },
                        { rationale: 'ê³ ê°ì˜ ìˆ¨ê²¨ì§„ ë‹ˆì¦ˆë¥¼ íŒŒì•…í•˜ë ¤ëŠ” ë…¸ë ¥ì´ ë¶€ì¡±í–ˆìŠµë‹ˆë‹¤.', improvement: 'ê³ ê°ì˜ í‘œì •ì´ë‚˜ ë§íˆ¬ë¥¼ í†µí•´ ì–´ë–¤ ì œí’ˆì„ ì›í•˜ëŠ”ì§€ ë” ê¹Šì´ ìƒê°í•˜ê³  ì§ˆë¬¸í•´ ë³´ì„¸ìš”.' },
                        { rationale: 'íšì¼ì ì¸ ì¶”ì²œ ë©˜íŠ¸ë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.', improvement: 'ê° ê³ ê°ì˜ ìƒí™©ì— ë§ëŠ” íŠ¹ë³„í•œ ì¶”ì²œ ë©˜íŠ¸ë¥¼ ì—°ìŠµí•´ ë³´ì„¸ìš”.' },
                        { rationale: 'ì¬ì¹˜ ìˆëŠ” ë©˜íŠ¸ê°€ ë¶€ì¡±í•˜ì—¬ ë”±ë”±í•œ ë¶„ìœ„ê¸°ë¥¼ ì£¼ì—ˆìŠµë‹ˆë‹¤.', improvement: 'ëŒ€í™”ì˜ íë¦„ì„ ë¶€ë“œëŸ½ê²Œ ë§Œë“¤ ìˆ˜ ìˆëŠ” ì§§ê³  ì¬ë¯¸ìˆëŠ” ë©˜íŠ¸ë¥¼ ì¤€ë¹„í•´ ë³´ì„¸ìš”.' },
                        { rationale: 'êµ¬ë§¤ ìœ ë„ ë©˜íŠ¸ê°€ ì•½í–ˆìŠµë‹ˆë‹¤.', improvement: 'ê³ ê°ì´ êµ¬ë§¤ë¥¼ ê²°ì‹¬í–ˆì„ ë•Œ "ë°”ë¡œ í¬ì¥í•´ ë“œë¦´ê¹Œìš”?"ì™€ ê°™ì´ ì ê·¹ì ì¸ í´ë¡œì§•ì„ ì‹œë„í•´ ë³´ì„¸ìš”.' }
                    ]
                },
                {
                    name: 'ìœ ì˜í¬', total: 67, scores: [8, 9, 7, 6, 8, 6, 5, 7, 5, 6],
                    feedback: [
                        { rationale: 'ì œí’ˆì˜ ì£¼ìš” íŠ¹ì§•ì„ ì˜ ì„¤ëª…í–ˆìŠµë‹ˆë‹¤.', improvement: 'ì„¤ëª…í•  ë•Œ ê³ ê°ì˜ ëˆˆë†’ì´ì— ë§ì¶° ì–´ë ¤ìš´ ìš©ì–´ë¥¼ í’€ì–´ ì„¤ëª…í•´ ì£¼ì„¸ìš”.' },
                        { rationale: 'ì œí’ˆ ì‚¬ìš©ë²• ì„¤ëª…ì€ ì¢‹ì•˜ìŠµë‹ˆë‹¤.', improvement: 'ê³ ê°ì´ ì–´ë ¤ì›Œí•˜ëŠ” ë¶€ë¶„ì´ ì—†ëŠ”ì§€ ì§ì ‘ í™•ì¸í•´ ì£¼ëŠ” ì ê·¹ì„±ì´ í•„ìš”í•©ë‹ˆë‹¤.' },
                        { rationale: 'ë¬¶ìŒ íŒë§¤ ì œì•ˆì´ ì•½í–ˆìŠµë‹ˆë‹¤.', improvement: 'ì—¬ëŸ¬ ê°œë¥¼ í•¨ê»˜ êµ¬ë§¤í•˜ë©´ ë” ì¢‹ë‹¤ëŠ” ì ì„ ëª…í™•íˆ ì„¤ëª…í•´ ì£¼ì„¸ìš”.' },
                        { rationale: 'ì¹œì ˆí–ˆì§€ë§Œ, ëª©ì†Œë¦¬ í†¤ì´ ë‹¤ì†Œ ë‚®ì•„ í™œê¸°ê°€ ë¶€ì¡±í–ˆìŠµë‹ˆë‹¤.', improvement: 'ë°ê³  ê¸ì •ì ì¸ ëª©ì†Œë¦¬ë¥¼ ë‚´ëŠ” ì—°ìŠµì„ í•´ë³´ì„¸ìš”.' },
                        { rationale: 'ìì‹ ê° ìˆëŠ” ì‘ëŒ€ íƒœë„ê°€ í•„ìš”í•©ë‹ˆë‹¤.', improvement: 'ì œí’ˆì— ëŒ€í•œ ì§€ì‹ì„ ì™„ë²½í•˜ê²Œ ìˆ™ì§€í•˜ê³  ìì‹ ê°ì„ ê°€ì§€ì„¸ìš”.' },
                        { rationale: 'ê³ ê°ê³¼ì˜ ëŒ€í™”ê°€ ë‹¨ì ˆë˜ëŠ” ê²½í–¥ì´ ìˆì—ˆìŠµë‹ˆë‹¤.', improvement: 'ê³ ê°ì—ê²Œ "ì–´ë–¤ ìš©ë„ë¡œ ì‚¬ìš©í•˜ì‹¤ ê³„íšì´ì„¸ìš”?"ì™€ ê°™ì€ ì§ˆë¬¸ìœ¼ë¡œ ëŒ€í™”ë¥¼ ì´ì–´ê°€ì„¸ìš”.' },
                        { rationale: 'ê³ ê°ì˜ ë‹ˆì¦ˆë¥¼ íŒŒì•…í•˜ëŠ” ë…¸ë ¥ì´ ë¶€ì¡±í–ˆìŠµë‹ˆë‹¤.', improvement: 'ê³ ê°ì´ ì›í•˜ëŠ” ë°”ë¥¼ ëª…í™•íˆ ì•Œê¸° ìœ„í•´ ë” ë§ì€ ì§ˆë¬¸ì„ í•´ì•¼ í•©ë‹ˆë‹¤.' },
                        { rationale: 'ê°œì¸í™”ëœ ì œí’ˆ ì¶”ì²œì´ ì•½í–ˆìŠµë‹ˆë‹¤.', improvement: 'ê³ ê°ì˜ ì·¨í–¥ì´ë‚˜ ê°€ì¡± ìƒí™©ì„ ê³ ë ¤í•œ ë§ì¶¤í˜• ì¶”ì²œì„ ì‹œë„í•´ ë³´ì„¸ìš”.' },
                        { rationale: 'ì¬ì¹˜ ìˆëŠ” ë©˜íŠ¸ê°€ ì—†ì–´ ëŒ€í™”ê°€ ë”±ë”±í–ˆìŠµë‹ˆë‹¤.', improvement: 'ëŒ€í™”ë¥¼ ìœ ì—°í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆëŠ” ìœ ë¨¸ë‚˜ ê³µê° ë©˜íŠ¸ë¥¼ ì¤€ë¹„í•´ ë³´ì„¸ìš”.' },
                        { rationale: 'í´ë¡œì§• ëŠ¥ë ¥ì´ ë¶€ì¡±í–ˆìŠµë‹ˆë‹¤.', improvement: 'ê³ ê°ì´ ì œí’ˆì„ ì‚´ì§ ë§Œì ¸ë³´ëŠ” ë“± êµ¬ë§¤ì— ëŒ€í•œ ê¸ì •ì ì¸ ì‹ í˜¸ë¥¼ ë³´ë‚¼ ë•Œ, ì¦‰ì‹œ í´ë¡œì§•ì„ ì‹œë„í•´ ë³´ì„¸ìš”.' }
                    ]
                }
            ];

            const allEmployees = [
                ...employeeData,
                { name: 'ì‹ ë™ìˆœ', total: 91, scores: [9, 10, 9, 8, 9, 9, 10, 9, 9, 9], feedback: [] },
                { name: 'ê¹€ë¯¼ì •', total: 89, scores: [9, 8, 9, 10, 9, 9, 9, 8, 8, 10], feedback: [] },
                { name: 'ê¹€ì¢…ê²½', total: 87, scores: [9, 10, 9, 8, 9, 9, 9, 9, 7, 8], feedback: [] },
                { name: 'í•œí˜œì§„', total: 83, scores: [9, 10, 6, 8, 10, 8, 8, 7, 9, 8], feedback: [] },
                { name: 'ì„œì—°ìˆœ', total: 81, scores: [9, 6, 8, 8, 9, 10, 10, 5, 7, 9], feedback: [] },
                { name: 'ì´ì• ê²½', total: 81, scores: [9, 9, 6, 8, 10, 9, 8, 8, 6, 8], feedback: [] },
                { name: 'ê¹€ê²½ì', total: 80, scores: [8, 6, 8, 8, 9, 9, 9, 7, 7, 9], feedback: [] },
                { name: 'ê¹€ê¸¸ì', total: 75, scores: [9, 6, 6, 8, 9, 8, 7, 8, 6, 8], feedback: [] },
                { name: 'ë°•ì‹œì—°', total: 75, scores: [8, 7, 10, 6, 10, 5, 5, 6, 9, 9], feedback: [] },
                { name: 'ì†ì •ì• ', total: 69, scores: [8, 7, 8, 7, 9, 6, 6, 5, 6, 7], feedback: [] },
                { name: 'ê¹€ìˆ™í¬', total: 90, scores: [9, 10, 9, 8, 9, 9, 10, 10, 7, 9], feedback: [] },
            ];
            
            const evaluationLabels = [
                'ì œí’ˆ íŠ¹ì§• ì„¤ëª…', 'ì œí’ˆ ì‚¬ìš© ì„¤ëª…', 'ë¬¶ìŒ íŒë§¤', 'ì¹œì ˆ', 'ìì‹ ê°', 
                'ê³ ê° ì†Œí†µ', 'ê³ ê° ë‹ˆì¦ˆ íŒŒì•…', 'ê°œì¸í™”ëœ ì œí’ˆ ì¶”ì²œ', 'ì¬ì¹˜ ìˆëŠ” ë©˜íŠ¸', 'í´ë¡œì§• ëŠ¥ë ¥'
            ];

            const employeeNameInput = document.getElementById('employeeNameInput');
            const previewButton = document.getElementById('previewButton');
            const captureAndCopyButton = document.getElementById('captureAndCopyButton');
            const previewSection = document.getElementById('preview-section');
            const previewContent = document.getElementById('preview-content');
            
            const copyModal = document.getElementById('copyModal');
            const modalContent = document.getElementById('modalContent');
            const closeButton = document.querySelector('.close-button');

            let chartInstance = null;

            // Function to render the preview report
            function renderReport(employeeName) {
                const employee = employeeData.find(e => e.name === employeeName);
                const employeeAllData = allEmployees.find(e => e.name === employeeName);

                if (!employeeAllData) {
                    previewContent.innerHTML = `<p class="text-red-600 font-bold text-center">ì‚¬ì› ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>`;
                    return;
                }
                
                // Clear previous chart if it exists
                if (chartInstance) {
                    chartInstance.destroy();
                }

                // Calculate average and max scores
                const averageScores = new Array(evaluationLabels.length).fill(0);
                const maxScores = new Array(evaluationLabels.length).fill(0);

                allEmployees.forEach(e => {
                    e.scores.forEach((score, index) => {
                        averageScores[index] += score;
                        if (score > maxScores[index]) {
                            maxScores[index] = score;
                        }
                    });
                });

                for (let i = 0; i < averageScores.length; i++) {
                    averageScores[i] /= allEmployees.length;
                }
                
                // Dynamically determine the bar colors
                const myScoreColors = employeeAllData.scores.map((score, index) => {
                    if (score > averageScores[index]) {
                        return 'rgba(255, 105, 180, 0.7)'; // Hot Pink
                    } else if (score < averageScores[index]) {
                        return 'rgba(135, 206, 250, 0.7)'; // Sky Blue
                    } else {
                        return 'rgba(150, 150, 150, 0.7)'; // Gray
                    }
                });

                let feedbackHtml = `<p>ì•„ì§ ì´ ì‚¬ì›ì— ëŒ€í•œ ìƒì„¸ í”¼ë“œë°±ì´ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë§¤ë‹ˆì €ë‹˜ê»˜ì„œ ì§ì ‘ í”¼ë“œë°±ì„ ì¶”ê°€í•´ ì£¼ì„¸ìš”.</p>`;
                if (employee && employee.feedback && employee.feedback.length > 0) {
                    feedbackHtml = employee.feedback.map((item, index) => `
                        <div class="mb-6 p-4 border rounded-lg bg-gray-50">
                            <h4 class="font-bold text-lg text-gray-800 mb-2">${index + 1}. ${evaluationLabels[index]} (${employee.scores[index]}ì )</h4>
                            <p class="mb-2"><strong class="text-blue-600">í‰ê°€ ê·¼ê±°:</strong> ${item.rationale}</p>
                            <p><strong class="text-green-600">ê°œì„ í•  ì :</strong> ${item.improvement}</p>
                        </div>
                    `).join('');
                }

                let generalMessage = '';
                if (employeeAllData.total >= 90) {
                    generalMessage = 'ë§¤ìš° ìš°ìˆ˜í•œ ì„±ê³¼ë¥¼ ë³´ì—¬ì£¼ì…¨ìŠµë‹ˆë‹¤. íƒì›”í•œ ì—­ëŸ‰ê³¼ ì ê·¹ì ì¸ ìì„¸ë¡œ íŒ€ì— í° ê¸°ì—¬ë¥¼ í•˜ê³  ìˆìŠµë‹ˆë‹¤. í˜„ì¬ì˜ ê°•ì ì„ ë”ìš± ë°œì „ì‹œì¼œ ë¦¬ë”ë¡œì„œì˜ ì—­ëŸ‰ì„ í‚¤ì›Œë‚˜ê°€ì‹œê¸¸ ë°”ëë‹ˆë‹¤.';
                } else if (employeeAllData.total >= 80) {
                    generalMessage = 'í›Œë¥­í•œ ì—­ëŸ‰ì„ ë°œíœ˜í•˜ê³  ìˆìŠµë‹ˆë‹¤. ëŒ€ë¶€ë¶„ì˜ í‰ê°€ í•­ëª©ì—ì„œ í‰ê·  ì´ìƒì˜ ì ìˆ˜ë¥¼ ê¸°ë¡í•˜ë©° ì•ˆì •ì ì¸ ì„±ê³¼ë¥¼ ë‚´ê³  ìˆìŠµë‹ˆë‹¤. ë¶€ì¡±í•œ ë¶€ë¶„ì„ ë³´ì™„í•œë‹¤ë©´ ë”ìš± ë›°ì–´ë‚œ ì„±ê³¼ë¥¼ ë‚¼ ìˆ˜ ìˆì„ ê²ƒì…ë‹ˆë‹¤.';
                } else if (employeeAllData.total >= 70) {
                    generalMessage = 'ì•ˆì •ì ì¸ ì—­ëŸ‰ì„ ë³´ì—¬ì£¼ê³  ìˆìŠµë‹ˆë‹¤. íŠ¹ì • ë¶„ì•¼ì—ì„œëŠ” ê°•ì ì„ ë³´ì´ì§€ë§Œ, ëª‡ëª‡ í•­ëª©ì—ì„œ ê°œì„ ì´ í•„ìš”í•©ë‹ˆë‹¤. ëª©í‘œë¥¼ ì„¤ì •í•˜ê³  ê¾¸ì¤€íˆ ë…¸ë ¥í•˜ë©´ ë” í° ì„±ì¥ì„ ì´ë£° ìˆ˜ ìˆì„ ê²ƒì…ë‹ˆë‹¤.';
                } else {
                    generalMessage = 'ì„±ì¥ì„ ìœ„í•œ ë…¸ë ¥ì´ í•„ìš”í•œ ì‹œì ì…ë‹ˆë‹¤. ê³ ê° ì‘ëŒ€ ê¸°ìˆ ê³¼ ì œí’ˆ ì§€ì‹ í–¥ìƒì— ì§‘ì¤‘í•˜ì—¬ ê¸°ë³¸ê¸°ë¥¼ ë‹¤ì ¸ë‚˜ê°€ì•¼ í•©ë‹ˆë‹¤. ì´ë²ˆ í”¼ë“œë°±ì„ ë°”íƒ•ìœ¼ë¡œ ê°œì„ ì ì„ íŒŒì•…í•˜ê³  ì ê·¹ì ìœ¼ë¡œ ë°œì „ì‹œì¼œ ë‚˜ê°€ì‹œê¸¸ ë°”ëë‹ˆë‹¤.';
                }

                const reportHtml = `
                    <div class="text-center mb-6">
                        <h2 class="text-2xl font-extrabold text-blue-600 mb-2">${employeeName} ì‚¬ì›</h2>
                        <p class="text-gray-600 text-lg">ì¢…í•© ì ìˆ˜: <span class="text-2xl font-bold text-gray-800">${employeeAllData.total}</span>ì </p>
                    </div>

                    <div class="card p-4 border rounded-xl mb-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-2 text-left">ì„¸ë¶€ í‰ê°€ í•­ëª©</h3>
                        <div class="chart-container">
                            <canvas id="previewChart"></canvas>
                        </div>
                        <!-- Legend for bar colors -->
                        <div class="mt-4 flex flex-col items-center space-y-2 text-sm text-gray-600 md:flex-row md:justify-center md:space-y-0 md:space-x-4">
                            <div class="flex items-center">
                                <span class="w-8 h-4 rounded-sm mr-2" style="background-color: rgba(255, 105, 180, 0.7);"></span>
                                <span>í‰ê· ë³´ë‹¤ ë†’ìŒ</span>
                            </div>
                            <div class="flex items-center">
                                <span class="w-8 h-4 rounded-sm mr-2" style="background-color: rgba(135, 206, 250, 0.7);"></span>
                                <span>í‰ê· ë³´ë‹¤ ë‚®ìŒ</span>
                            </div>
                            <div class="flex items-center">
                                <span class="w-8 h-4 rounded-sm mr-2" style="background-color: rgba(150, 150, 150, 0.7);"></span>
                                <span>í‰ê· ê³¼ ê°™ìŒ</span>
                            </div>
                        </div>
                    </div>

                    <div class="card p-4 border rounded-xl mb-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-2 text-left">ì¢…í•© í”¼ë“œë°±</h3>
                        <div class="text-gray-700 text-sm leading-relaxed text-left">${feedbackHtml}</div>
                    </div>

                    <div class="card p-4 border rounded-xl">
                        <h3 class="text-lg font-bold text-gray-800 mb-2 text-left">ğŸ˜Š ì´í‰</h3>
                        <div class="text-gray-700 text-sm leading-relaxed text-left">${generalMessage}</div>
                    </div>
                `;
                
                previewContent.innerHTML = reportHtml;
                previewSection.classList.remove('hidden');

                // Create the preview chart
                const previewChartCtx = document.getElementById('previewChart').getContext('2d');
                chartInstance = new Chart(previewChartCtx, {
                    data: {
                        labels: evaluationLabels,
                        datasets: [
                            {
                                type: 'bar',
                                label: 'ë‚˜ì˜ ì ìˆ˜',
                                data: employeeAllData.scores,
                                backgroundColor: myScoreColors,
                                borderColor: myScoreColors,
                                borderWidth: 1
                            },
                            {
                                type: 'line',
                                label: 'í‰ê·  ì ìˆ˜',
                                data: averageScores,
                                backgroundColor: 'blue',
                                borderColor: 'blue',
                                pointStyle: 'circle',
                                pointRadius: 8,
                                pointHoverRadius: 10,
                                showLine: false
                            },
                            {
                                type: 'line',
                                label: 'ìµœê³  ì ìˆ˜',
                                data: maxScores,
                                backgroundColor: 'red',
                                borderColor: 'red',
                                pointStyle: 'circle',
                                pointRadius: 8,
                                pointHoverRadius: 10,
                                showLine: false
                            }
                        ]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                labels: {
                                    usePointStyle: true,
                                    filter: function(item, chart) {
                                        return item.text !== 'ë‚˜ì˜ ì ìˆ˜';
                                    }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed.x !== null) {
                                            label += context.parsed.x.toFixed(1) + 'ì ';
                                        }
                                        return label;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                beginAtZero: true,
                                max: 10,
                                title: {
                                    display: true,
                                    text: 'ì ìˆ˜'
                                }
                            },
                            y: {
                                ticks: {
                                    callback: function(value, index, ticks) {
                                        return evaluationLabels[index];
                                    }
                                }
                            }
                        }
                    }
                });
            }

            previewButton.addEventListener('click', function() {
                const name = employeeNameInput.value.trim();
                if (name) {
                    renderReport(name);
                } else {
                    previewContent.innerHTML = `<p class="text-red-600 font-bold text-center">ì‚¬ì› ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>`;
                    previewSection.classList.remove('hidden');
                }
            });

            captureAndCopyButton.addEventListener('click', function() {
                const name = employeeNameInput.value.trim();
                if (!name) {
                    showModal('ì‚¬ì› ì´ë¦„ì„ ì…ë ¥í•´ì•¼ ì´ë¯¸ì§€ë¥¼ ë³µì‚¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                    return;
                }

                // Show loading spinner
                modalContent.innerHTML = `
                    <div class="spinner"></div>
                    <p class="mt-4">ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
                `;
                copyModal.style.display = 'block';
                
                // Get the preview content element
                const contentToCapture = document.getElementById('preview-content');

                html2canvas(contentToCapture, {
                    scale: 2, // Capture at a higher resolution for better quality
                    useCORS: true
                }).then(canvas => {
                    canvas.toBlob(blob => {
                        if (navigator.clipboard && navigator.clipboard.write) {
                            try {
                                const item = new ClipboardItem({ 'image/png': blob });
                                navigator.clipboard.write([item]).then(() => {
                                    showSuccessModal(canvas.toDataURL());
                                }).catch(err => {
                                    console.error('Failed to copy image to clipboard:', err);
                                    showErrorModal('ì´ë¯¸ì§€ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                                });
                            } catch (e) {
                                console.error('ClipboardItem error:', e);
                                showErrorModal('ì´ë¯¸ì§€ ë³µì‚¬ë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.');
                            }
                        } else {
                            showErrorModal('ë¸Œë¼ìš°ì €ê°€ ì´ë¯¸ì§€ ë³µì‚¬ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                        }
                    }, 'image/png');
                });
            });

            // Modal related functions
            function showModal(message) {
                modalContent.innerHTML = `<p class="text-red-600 font-bold text-lg">${message}</p>`;
                copyModal.style.display = 'block';
            }

            function showSuccessModal(imageDataUrl) {
                modalContent.innerHTML = `
                    <h3 class="text-xl font-bold text-green-600 mb-4">ì´ë¯¸ì§€ ë³µì‚¬ ì„±ê³µ!</h3>
                    <p class="text-gray-700 mb-4">ì•„ë˜ ì´ë¯¸ì§€ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì‚¬ì›ì—ê²Œ ë°”ë¡œ ê³µìœ í•´ ë³´ì„¸ìš”.</p>
                    <div class="mobile-preview-container mb-4">
                        <img src="${imageDataUrl}" class="w-full h-auto rounded-lg max-w-none">
                    </div>
                `;
            }

            function showErrorModal(message) {
                modalContent.innerHTML = `
                    <h3 class="text-xl font-bold text-red-600 mb-4">ì˜¤ë¥˜ ë°œìƒ</h3>
                    <p class="text-gray-700">${message}</p>
                `;
            }

            closeButton.onclick = function() {
                copyModal.style.display = 'none';
            }

            window.onclick = function(event) {
                if (event.target == copyModal) {
                    copyModal.style.display = 'none';
                }
            }
        });
    </script>
</body>
</html>
